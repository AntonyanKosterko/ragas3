#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ RAG —Å–∏—Å—Ç–µ–º—ã —Å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º –¥–∞—Ç–∞—Å–µ—Ç–æ–º
# –ê–≤—Ç–æ—Ä: RAG Assistant
# –î–∞—Ç–∞: $(date)

echo "üöÄ –ó–∞–ø—É—Å–∫ RAG —Å–∏—Å—Ç–µ–º—ã —Å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º –¥–∞—Ç–∞—Å–µ—Ç–æ–º"
echo "=============================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "app.py" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ RAGAS"
    exit 1
fi

# –°–æ–∑–¥–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
mkdir -p logs
mkdir -p results
mkdir -p datasets/sberquad/vector_db

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –¥–∞—Ç–∞—Å–µ—Ç SberQuAD
if [ ! -f "datasets/sberquad/documents_for_rag.json" ]; then
    echo "üìÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞ SberQuAD..."
    python load_sberquad.py
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î
if [ ! -d "datasets/sberquad/vector_db" ] || [ ! "$(ls -A datasets/sberquad/vector_db)" ]; then
    echo "üîç –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î..."
    python test_rag.py --config config/base_config.yaml --rebuild-vector-db --max-samples 100
fi

echo "‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
echo "üåê –ó–∞–ø—É—Å–∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞..."
echo "üì± –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:7860"
echo "üõë –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
python app.py --config config/base_config.yaml --interface gradio
