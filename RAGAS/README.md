# üöÄ RAG –°–∏—Å—Ç–µ–º–∞ —Å –¥–∞—Ç–∞—Å–µ—Ç–æ–º SberQuAD

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

RAG (Retrieval-Augmented Generation) —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –∏ –æ—Ç–≤–µ—Ç–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞—Ç–∞—Å–µ—Ç–∞ SberQuAD.

### üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- **–î–∞—Ç–∞—Å–µ—Ç**: SberQuAD (2000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, 500 –≤–æ–ø—Ä–æ—Å–æ–≤-–æ—Ç–≤–µ—Ç–æ–≤)
- **–ú–æ–¥–µ–ª–∏**: –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ + –∫–∞—Å—Ç–æ–º–Ω–∞—è RAG –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: Gradio –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **MLflow**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞
```bash
python load_sberquad.py
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```bash
# –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (10 –ø—Ä–∏–º–µ—Ä–æ–≤)
python test_rag.py --config config/cpu_optimized_config.yaml --max-samples 10

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç (500 –ø—Ä–∏–º–µ—Ä–æ–≤)
python test_rag.py --config config/cpu_optimized_config.yaml --max-samples 500
```

### 4. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```bash
python app.py --config config/cpu_optimized_config.yaml --interface gradio
```
–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: http://localhost:7860

### 5. MLflow UI
```bash
mlflow ui --backend-store-uri file:./mlruns --host 0.0.0.0 --port 5000
```
–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: http://localhost:5000

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
RAGAS/
‚îú‚îÄ‚îÄ load_sberquad.py              # –ó–∞–≥—Ä—É–∑—á–∏–∫ –¥–∞—Ç–∞—Å–µ—Ç–∞ SberQuAD
‚îú‚îÄ‚îÄ test_rag.py                   # –¢–µ—Å—Ç–µ—Ä RAG —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ app.py                        # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ main.py                       # –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —Å MLflow
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ cpu_optimized_config.yaml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è CPU (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
‚îÇ   ‚îú‚îÄ‚îÄ gpu_optimal_config.yaml   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è GPU
‚îÇ   ‚îî‚îÄ‚îÄ base_config.yaml          # –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ src/                          # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ pipeline.py               # RAG –ø–∞–π–ø–ª–∞–π–Ω
‚îÇ   ‚îú‚îÄ‚îÄ evaluation.py             # –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ models.py                 # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ rag_generator.py          # –ö–∞—Å—Ç–æ–º–Ω–∞—è RAG –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ dataset_loader.py         # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ datasets/sberquad/            # –î–∞—Ç–∞—Å–µ—Ç SberQuAD
‚îÇ   ‚îú‚îÄ‚îÄ documents_for_rag.json    # 2000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ qa_pairs.json             # 500 –≤–æ–ø—Ä–æ—Å–æ–≤-–æ—Ç–≤–µ—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ vector_db/                # –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î
‚îú‚îÄ‚îÄ results/                      # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ mlruns/                       # MLflow —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã
‚îî‚îÄ‚îÄ RETRIEVER_METRICS.md          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### CPU –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **–§–∞–π–ª**: `config/cpu_optimized_config.yaml`
- **–≠–º–±–µ–¥–¥–∏–Ω–≥**: `paraphrase-multilingual-MiniLM-L12-v2` (–º–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è)
- **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä**: –ö–∞—Å—Ç–æ–º–Ω–∞—è RAG –º–æ–¥–µ–ª—å
- **–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î**: FAISS (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è CPU)
- **–†–µ—Ç—Ä–∏–≤–µ—Ä**: 3 –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞

### GPU –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **–§–∞–π–ª**: `config/gpu_optimal_config.yaml`
- **–≠–º–±–µ–¥–¥–∏–Ω–≥**: `paraphrase-multilingual-mpnet-base-v2` (–º–æ—â–Ω–∞—è –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è)
- **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä**: `IlyaGusev/saiga_llama3_8b` (Saiga-7B)
- **–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î**: FAISS
- **–†–µ—Ç—Ä–∏–≤–µ—Ä**: 5 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ú–µ—Ç—Ä–∏–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
- **ROUGE** (1, 2, L) - –∫–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **BLEU** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —ç—Ç–∞–ª–æ–Ω—É
- **Exact Match** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
- **Cosine Similarity** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
- **Response Time** - –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞

### –ú–µ—Ç—Ä–∏–∫–∏ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞:
- **Precision@K** - —Ç–æ—á–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **Recall@K** - –ø–æ–ª–Ω–æ—Ç–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
- **F1@K** - –±–∞–ª–∞–Ω—Å —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø–æ–ª–Ω–æ—Ç—ã
- **Hit Rate@K** - –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–∏—Å–∫–æ–≤
- **MRR** - —Å—Ä–µ–¥–Ω–∏–π –æ–±—Ä–∞—Ç–Ω—ã–π —Ä–∞–Ω–≥
- **NDCG@K** - –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π DCG
- **Coverage** - –ø–æ–∫—Ä—ã—Ç–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **Diversity** - —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–∞–∑–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–∏–º–µ—Ä–æ–≤:
```bash
# –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (10 –ø—Ä–∏–º–µ—Ä–æ–≤)
python test_rag.py --config config/cpu_optimized_config.yaml --max-samples 10

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç (500 –ø—Ä–∏–º–µ—Ä–æ–≤)
python test_rag.py --config config/cpu_optimized_config.yaml --max-samples 500

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î
python test_rag.py --config config/cpu_optimized_config.yaml --rebuild-vector-db
```

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
- –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:7860
- –í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ü–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ SberQuAD

### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —Å MLflow:
```bash
python main.py --config config/cpu_optimized_config.yaml
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:
- `results/rag_test_results.json` - –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- MLflow UI - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

### –¢–∏–ø–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (CPU –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è):
- **Hit Rate**: 74.8% (—É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–∏—Å–∫–æ–≤)
- **Precision**: 24.9% (—Ç–æ—á–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è)
- **Recall**: 74.8% (–ø–æ–ª–Ω–æ—Ç–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è)
- **MRR**: 67.2% (–∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è)
- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞**: ~44–º—Å

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- 8GB RAM (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- CPU (GPU –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è CPU –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ:
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `cpu_optimized_config.yaml`
2. –£–º–µ–Ω—å—à–∏—Ç–µ `max_samples` –≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
3. –ó–∞–∫—Ä–æ–π—Ç–µ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞–º—è—Ç–∏:
1. –£–º–µ–Ω—å—à–∏—Ç–µ `batch_size` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—å—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ
3. –ó–∞–∫—Ä–æ–π—Ç–µ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ï—Å–ª–∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 7860 —Å–≤–æ–±–æ–¥–µ–Ω
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--interface streamlit` –≤–º–µ—Å—Ç–æ gradio

### –ï—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞ –Ω—É–ª–µ–≤—ã–µ:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î: `--rebuild-vector-db`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞—Ç–∞—Å–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìù –õ–æ–≥–∏

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `logs/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `pip install -r requirements.txt`
2. –ó–∞–≥—Ä—É–∂–µ–Ω –ª–∏ –¥–∞—Ç–∞—Å–µ—Ç: `python load_sberquad.py`
3. –°–æ–∑–¥–∞–Ω–∞ –ª–∏ –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î: `python test_rag.py --rebuild-vector-db`
4. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `cpu_optimized_config.yaml`

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `RETRIEVER_METRICS.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞
- MLflow UI - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫
- `results/` - –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è