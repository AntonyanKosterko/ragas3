# RAG Система - Конфигурации для CPU

## Обзор конфигураций

Проект содержит несколько конфигураций для работы на CPU без GPU:

### 1. `cpu_optimized_config.yaml` (Рекомендуется)
- **Оптимизированная конфигурация для CPU**
- Использует FAISS вместо ChromaDB (быстрее на CPU)
- Уменьшенные размеры чанков (500 символов)
- Меньше документов для извлечения (3 вместо 5)
- Кастомная RAG генератор (не требует GPU)

### 2. `cpu_test_config.yaml` (Для быстрого тестирования)
- **Минимальная конфигурация для тестирования**
- Очень маленькие чанки (300 символов)
- Только 2 документа для извлечения
- Одна метрика оценки
- Отключено логирование в файлы

### 3. `base_config.yaml` (Базовая)
- **Стандартная конфигурация**
- ChromaDB векторная база
- Средние размеры чанков (1000 символов)
- 5 документов для извлечения

## Быстрый запуск

### Использование скрипта `run_cpu.py`:

```bash
# Запуск веб-интерфейса с оптимизированной конфигурацией
python run_cpu.py --config optimized --interface gradio

# Запуск веб-интерфейса с тестовой конфигурацией
python run_cpu.py --config test --interface gradio

# Запуск эксперимента с оптимизированной конфигурацией
python run_cpu.py --config optimized --mode experiment

# Тестирование на датасете с тестовой конфигурацией
python run_cpu.py --config test --mode test_dataset
```

### Прямой запуск:

```bash
# Веб-интерфейс
python app.py --config config/cpu_optimized_config.yaml --interface gradio

# Эксперимент
python main.py --config config/cpu_optimized_config.yaml

# Тест на датасете
python test_rag_dataset.py --config config/cpu_test_config.yaml
```

## Рекомендации по выбору конфигурации

### Для разработки и тестирования:
```bash
python run_cpu.py --config test --interface gradio
```

### Для полноценной работы:
```bash
python run_cpu.py --config optimized --interface gradio
```

### Для экспериментов и оценки:
```bash
python run_cpu.py --config optimized --mode experiment
```

## Особенности CPU конфигураций

### Оптимизации для CPU:
1. **FAISS вместо ChromaDB** - быстрее работает на CPU
2. **Уменьшенные размеры чанков** - меньше памяти и быстрее обработка
3. **Меньше документов для извлечения** - быстрее поиск
4. **Кастомная RAG генератор** - не требует GPU, работает только с CPU
5. **Оптимизированные размеры батчей** - меньше нагрузки на CPU

### Мониторинг ресурсов:
- Следите за использованием памяти (должно быть < 4GB)
- CPU загрузка может быть высокой при обработке
- Векторная база создается один раз, затем переиспользуется

## Устранение проблем

### Если система работает медленно:
1. Используйте `cpu_test_config.yaml`
2. Уменьшите `chunk_size` в конфигурации
3. Уменьшите `k` в настройках ретривера

### Если не хватает памяти:
1. Уменьшите `batch_size` в настройках оценки
2. Используйте `cpu_test_config.yaml`
3. Закройте другие приложения

### Если веб-интерфейс не запускается:
1. Проверьте, что порт 7860 свободен
2. Попробуйте другой порт в конфигурации
3. Используйте `--interface streamlit` вместо gradio






