# Оптимизированная конфигурация для CPU (без GPU)
experiment:
  name: "rag_cpu_optimized_experiment"
  description: "RAG эксперимент оптимизированный для CPU с минимальным потреблением ресурсов"
  tags: ["rag", "cpu", "russian", "optimized", "evaluation"]

# Настройки данных (оптимизированы для CPU)
data:
  input_path: "datasets/sberquad/documents_for_rag.json"
  dataset_path: "datasets/sberquad/qa_pairs.json"
  chunk_size: 500  # Уменьшено для быстрой обработки на CPU
  chunk_overlap: 100  # Уменьшено для экономии памяти
  text_splitter: "recursive"
  
# Настройки датасетов
datasets:
  sberquad:
    path: "datasets/sberquad"
    documents_file: "documents_for_rag.json"
    qa_pairs_file: "qa_pairs.json"
    vector_db_path: "datasets/sberquad/vector_db"

# Настройки моделей (оптимизированы для CPU)
models:
  # Эмбеддинг модель (многоязычная для лучшего качества)
  embedding:
    name: "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2"  # Многоязычная модель
    device: "cpu"
    normalize_embeddings: true
    
  # Генеративная модель (кастомная RAG модель - не требует GPU)
  generator:
    name: "rag"  # Используем кастомную RAG модель
    device: "cpu"
    max_new_tokens: 150  # Увеличено для более полных ответов
    temperature: 0.7
    do_sample: true

# Настройки векторной базы (оптимизированы для CPU)
vector_store:
  type: "faiss"  # FAISS быстрее на CPU чем ChromaDB
  persist_directory: "datasets/sberquad/vector_db"
  collection_name: "sberquad_documents"

# Настройки ретривера (оптимизированы для CPU)
retriever:
  k: 3  # Уменьшено для быстрого поиска
  search_type: "similarity"
  fetch_k: 10  # Уменьшено для экономии ресурсов

# Настройки оценки (оптимизированы для CPU)
evaluation:
  metrics:
    # === ГРУППА 1: МЕТРИКИ ГЕНЕРАЦИИ ===
    - "cosine_similarity"  # Семантическое сходство
    - "rouge"              # ROUGE метрики (1, 2, L)
    
    # === ГРУППА 2: RAG-СПЕЦИФИЧНЫЕ МЕТРИКИ ===
    - "keyword_overlap"           # Пересечение ключевых слов
    - "contains_ground_truth"     # Содержит ли ответ эталон
    - "partial_match"            # Частичное совпадение
    - "answer_completeness"      # Полнота ответа
    - "information_density"      # Плотность информации
    
    # === ГРУППА 3: МЕТРИКИ РЕТРИВЕРА ===
    - "retriever_precision"      # Точность ретривера (Precision@K)
    - "retriever_recall"         # Полнота ретривера (Recall@K)
    - "retriever_f1"            # F1-мера ретривера
    - "retriever_hit_rate"      # Hit Rate@K
    - "retriever_mrr"           # Mean Reciprocal Rank
    - "retriever_ndcg"          # Normalized DCG
    - "retriever_coverage"      # Покрытие релевантных документов
    - "retriever_diversity"     # Разнообразие извлеченных документов
    
  batch_size: 2  # Уменьшено для CPU
  save_predictions: true

# Настройки MLflow
mlflow:
  experiment_name: "RAG_CPU_Optimized_Experiments"
  tracking_uri: "file:./mlruns"
  log_artifacts: true
  log_models: true

# Настройки веб-интерфейса (оптимизированы для CPU)
web:
  interface: "gradio"  # Gradio легче чем Streamlit
  port: 7860
  host: "0.0.0.0"
  share: false

# Настройки логирования
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "logs/rag_cpu_optimized_experiment.log"

# Дополнительные настройки для CPU оптимизации
cpu_optimization:
  # Настройки для экономии памяти
  memory_efficient: true
  # Максимальное количество потоков для обработки
  max_workers: 2
  # Использовать ли кэширование для ускорения
  enable_caching: true
  # Размер кэша (в MB)
  cache_size_mb: 100






